<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì–µë§Œì¥ìê°€ ë˜ê³  ì‹¶ì–´! (v2.28)</title>
    <!-- ì™¸ë¶€ CSS íŒŒì¼ ì—°ê²° -->
    <link rel="stylesheet" href="css/style.css">
    <!-- í°íŠ¸ ë° ì•„ì´ì½˜ -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'Noto Sans KR', 'sans-serif'],
                    },
                    colors: {
                        primary: '#4F46E5',
                        secondary: '#10B981',
                        lightgray: '#F3F4F6',
                        darkgray: '#4B5563',
                    },
                    boxShadow: {
                        'card': '0 4px 12px 0 rgba(0, 0, 0, 0.07)',
                        'modal': '0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)',
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-out forwards',
                        'slide-up': 'slideUp 0.5s ease-out forwards',
                        'pulse-sm': 'pulse-sm 2s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: 0 },
                            '100%': { opacity: 1 },
                        },
                        slideUp: {
                            '0%': { opacity: 0, transform: 'translateY(20px)' },
                            '100%': { opacity: 1, transform: 'translateY(0)' },
                        },
                        'pulse-sm': {
                            '0%, 100%': { opacity: 1, transform: 'scale(1)' },
                            '50%': { opacity: .7, transform: 'scale(0.98)' },
                        }
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-lightgray font-sans antialiased">

    <!-- ë©”ì¸ ê²Œì„ ì»¨í…Œì´ë„ˆ -->
    <div id="game-container" class="container mx-auto max-w-6xl p-4 min-h-screen flex flex-col hidden">
        
        <!-- ìƒë‹¨ í—¤ë” -->
        <header class="flex justify-between items-center mb-4">
            <h1 class="text-2xl md:text-3xl font-bold text-primary">ì–µë§Œì¥ìê°€ ë˜ê³  ì‹¶ì–´!</h1>
            <div class="text-right">
                <div id="clock" class="text-xl md:text-2xl font-bold text-darkgray">20ì„¸ 0ê°œì›”</div>
                <div class="text-sm text-gray-500">ë³´ë¼ìŒ¤ê³¼ ì‚¬íšŒë¥¼ ë³´ë¼</div>
            </div>
        </header>

        <!-- ì§„í–‰ ìƒíƒœ ë°” -->
        <div class="mb-4">
            <div class="w-full bg-gray-200 rounded-full h-2.5">
                <div id="progress-bar" class="bg-primary h-2.5 rounded-full transition-all duration-500" style="width: 0%"></div>
            </div>
            <div class="flex justify-between text-sm text-gray-500 mt-1">
                <span>20ì„¸ (ì‹œì‘)</span>
                <span id="progress-age" class="font-semibold">í˜„ì¬ ë‚˜ì´: 20ì„¸</span>
                <span>80ì„¸ (ì¢…ë£Œ)</span>
            </div>
        </div>

        <!-- ë©”ì¸ ì½˜í…ì¸  ì˜ì—­ (PC: 2ë‹¨, ëª¨ë°”ì¼: 1ë‹¨) -->
        <div class="flex flex-col md:flex-row gap-4 flex-grow">

            <!-- ì™¼ìª½ íŒ¨ë„ (ìºë¦­í„° & ì¬ì •) -->
            <aside class="w-full md:w-1/3 lg:w-1/4 flex-shrink-0">
                <div class="bg-white p-5 rounded-xl shadow-card sticky top-4">
                    <!-- ìºë¦­í„° ì •ë³´ -->
                    <div id="character-info" class="text-center">
                        <div id="character-image-container" class="w-full h-56 bg-gray-200 rounded-lg flex items-center justify-center mb-3 overflow-hidden">
                            <span id="character-loading" class="text-gray-500">ìºë¦­í„° ìƒì„± ì¤‘...</span>
                            <img id="character-image" src="" alt="ìºë¦­í„°" class="hidden w-full h-full object-cover">
                        </div>
                        <h2 id="character-name" class="text-2xl font-bold text-darkgray"></h2>
                        <p id="character-job" class="text-lg text-primary"></p>
                    </div>

                    <!-- ì¬ì • ìƒíƒœ -->
                    <div class="mt-4">
                        <h3 classs="text-xl font-semibold mb-3 text-darkgray">ì¬ì • ìƒíƒœ</h3>
                        <div class="space-y-2">
                            <div>
                                <div class="flex justify-between text-lg">
                                    <span>ì´ ìì‚°:</span>
                                    <span id="total-assets" class="font-bold">â‚© 1,000ë§Œ</span>
                                </div>
                                <div class="flex justify-between text-sm text-gray-500">
                                    <span>í˜„ê¸ˆ:</span>
                                    <span id="cash-assets">â‚© 1,000ë§Œ</span>
                                </div>
                                <div class="flex justify-between text-sm text-gray-500">
                                    <span>ë¶€ë™ì‚°:</span>
                                    <span id="property-assets">â‚© 0</span>
                                </div>
                                <div class="flex justify-between text-sm text-gray-500">
                                    <span>íˆ¬ì:</span>
                                    <span id="stock-assets">â‚© 0</span>
                                </div>
                            </div>
                            <div class="pt-2 border-t">
                                <div class="flex justify-between text-base">
                                    <span>ì›” ìˆ˜ì…:</span>
                                    <span id="monthly-income" class="font-semibold text-green-600">+ â‚© 0</span>
                                </div>
                                <div class="flex justify-between text-base">
                                    <span>ì›” ì§€ì¶œ:</span>
                                    <span id="monthly-expenses" class="font-semibold text-red-600">- â‚© 20ë§Œ</span>
                                </div>
                                <div class="flex justify-between text-base font-bold mt-1">
                                    <span>ì›” ìˆœìˆ˜ìµ:</span>
                                    <span id="net-income" class="text-gray-700"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </aside>

            <!-- ì˜¤ë¥¸ìª½ íŒ¨ë„ (ì´ë²¤íŠ¸ ë¡œê·¸ & ê²Œì„ ìƒíƒœ) -->
            <main class="w-full md:w-2/3 lg:w-3/4">
                <div class="bg-white p-5 rounded-xl shadow-card min-h-[60vh] flex flex-col">
                    <div class="flex justify-between items-center mb-3">
                        <h2 class="text-2xl font-bold text-darkgray">ìƒì•  ì´ë²¤íŠ¸</h2>
                        <div class="flex items-center gap-2">
                            <span id="game-status" class="text-sm font-medium text-gray-500 px-3 py-1 bg-gray-100 rounded-full">ê²Œì„ ì§„í–‰ ì¤‘...</span>
                            <button id="pause-button" class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-primary/80 transition">
                                ì¼ì‹œì •ì§€
                            </button>
                        </div>
                    </div>
                    
                    <!-- ì´ë²¤íŠ¸ ë¡œê·¸ -->
                    <div id="event-log" class="flex-grow space-y-3 overflow-y-auto h-[50vh] pr-2">
                        <!-- ì´ë²¤íŠ¸ ë¡œê·¸ í•­ëª©ì´ ì—¬ê¸°ì— ì¶”ê°€ë©ë‹ˆë‹¤ -->
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- ì‹œì‘ í™”ë©´ -->
    <div id="start-screen" class="min-h-screen flex items-center justify-center bg-gradient-to-br from-primary to-secondary p-4 animate-fade-in">
        <div class="bg-white p-8 md:p-12 rounded-2xl shadow-modal text-center max-w-lg w-full">
            <h1 class="text-4xl font-bold text-darkgray mb-4">ì–µë§Œì¥ìê°€ ë˜ê³  ì‹¶ì–´!</h1>
            <p class="text-lg text-gray-600 mb-8">ë‹¹ì‹ ì˜ ê²½ì œì  ì„ íƒì´ ì¸ìƒì„ ê²°ì •í•©ë‹ˆë‹¤.</p>
            
            <div class="mb-6">
                <label for="player-name" class="block text-left text-sm font-medium text-gray-700 mb-2">ë‹¹ì‹ ì˜ ì´ë¦„ì€ ë¬´ì—‡ì¸ê°€ìš”?</label>
                <input type="text" id="player-name" placeholder="ì´ë¦„ ì…ë ¥..." class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary">
                <p id="name-error" class="text-red-500 text-sm text-left mt-1 hidden">ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!</p>
            </div>

            <div class="mb-8">
                <p class="block text-left text-sm font-medium text-gray-700 mb-2">ì„±ë³„ì„ ì„ íƒí•˜ì„¸ìš”.</p>
                <div class="flex gap-4">
                    <button id="select-male" class="flex-1 p-4 border border-gray-300 rounded-lg text-lg hover:bg-blue-50 focus:bg-blue-100 focus:ring-2 focus:ring-blue-400 focus:outline-none transition">
                        ğŸ‘¨â€ğŸ¦± ë‚¨ì
                    </button>
                    <button id="select-female" class="flex-1 p-4 border border-gray-300 rounded-lg text-lg hover:bg-pink-50 focus:bg-pink-100 focus:ring-2 focus:ring-pink-400 focus:outline-none transition">
                        ğŸ‘©â€ğŸ¦± ì—¬ì
                    </button>
                </div>
            </div>

            <button id="start-button" class="w-full bg-primary text-white py-4 rounded-lg text-xl font-bold hover:bg-primary/80 transition-transform transform hover:scale-105 active:scale-100 shadow-lg">
                ì¸ìƒ ì‹œì‘í•˜ê¸°!
            </button>
        </div>
    </div>

    <!-- ëª¨ë‹¬ì°½ -->
    <div id="modal" class="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center p-4 hidden animate-fade-in">
        <div id="modal-content" class="bg-white p-8 rounded-2xl shadow-modal max-w-lg w-full animate-slide-up">
            <h2 id="modal-title" class="text-2xl font-bold mb-4"></h2>
            <p id="modal-text" class="text-base text-gray-600 mb-6"></p>
            <div id="modal-choices" class="space-y-3">
                <!-- ì„ íƒì§€ê°€ ì—¬ê¸°ì— ì¶”ê°€ë©ë‹ˆë‹¤ -->
            </div>
        </div>
    </div>

    <!-- ê²Œì„ ì˜¤ë²„ í™”ë©´ -->
    <div id="game-over-screen" class="fixed inset-0 bg-gradient-to-br from-darkgray to-black/80 backdrop-blur-md flex items-center justify-center p-4 hidden animate-fade-in">
        <div class="bg-white p-8 md:p-12 rounded-2xl shadow-modal text-center max-w-lg w-full animate-slide-up">
            <h1 id="game-over-title" class="text-4xl font-bold text-darkgray mb-4"></h1>
            <p id="game-over-text" class="text-lg text-gray-600 mb-8"></p>
            <div class="text-3xl font-bold text-primary mb-8" id="final-assets"></div>
            <button id="restart-button" class="w-full bg-primary text-white py-4 rounded-lg text-xl font-bold hover:bg-primary/80 transition-transform transform hover:scale-105 active:scale-100 shadow-lg">
                ë‹¤ì‹œ íƒœì–´ë‚˜ê¸°
            </button>
        </div>
    </div>

    <!-- ì™¸ë¶€ JS íŒŒì¼ ì—°ê²° (ìˆœì„œ ì¤‘ìš”!) -->
    <!-- 1. ì‹œë‚˜ë¦¬ì˜¤ ë°ì´í„° ë¡œë“œ -->
    <script src="js/scenarios.js"></script>
    <!-- 2. ê²Œì„ ì—”ì§„(í´ë˜ìŠ¤) ë¡œë“œ -->
    <script src="js/game.js"></script>
    <!-- 3. ì•± ì‹¤í–‰ -->
    <script src="js/main.js"></script>
</body>
</html>
/* ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
body {
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
}

/* ìŠ¤í¬ë¡¤ë°” ìŠ¤íƒ€ì¼ë§ (Tailwindë¡œëŠ” ì–´ë ¤ì›€) */
#event-log::-webkit-scrollbar {
    width: 6px;
}

#event-log::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 10px;
}

#event-log::-webkit-scrollbar-thumb {
    background: #c5c5c5;
    border-radius: 10px;
}

#event-log::-webkit-scrollbar-thumb:hover {
    background: #a8a8a8;
}

/* ì´ë²¤íŠ¸ ë¡œê·¸ í•­ëª© ìŠ¤íƒ€ì¼ */
.log-item {
    padding: 12px;
    border-radius: 8px;
    animation: fadeIn 0.3s ease-out;
}
.log-item-default {
    background-color: #F9FAFB; /* bg-gray-50 */
    border-left: 4px solid #D1D5DB; /* border-gray-300 */
}
.log-item-event {
    background-color: #F0F9FF; /* bg-blue-50 */
    border-left: 4px solid #3B82F6; /* border-blue-500 */
    animation: pulse-sm 1.5s ease-out 1; /* í•œë²ˆë§Œ ê°•ì¡° */
}
.log-item-good {
    background-color: #F0FDF4; /* bg-green-50 */
    border-left: 4px solid #22C55E; /* border-green-500 */
}
.log-item-bad {
    background-color: #FFFBEB; /* bg-amber-50 */
    border-left: 4px solid #F59E0B; /* border-amber-500 */
}
.log-item-critical {
    background-color: #FEF2F2; /* bg-red-50 */
    border-left: 4px solid #EF4444; /* border-red-500 */
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(5px); }
    to { opacity: 1; transform: translateY(0); }
}

/* pulse-sm ì• ë‹ˆë©”ì´ì…˜ (Tailwind configì— ì •ì˜í•¨) */
@keyframes pulse-sm {
    0%, 100% {
        opacity: 1;
        transform: scale(1);
    }
    50% {
        opacity: .8;
        transform: scale(0.99);
    }
}

/* ì„ íƒ ë²„íŠ¼ í¬ì»¤ìŠ¤ ìŠ¤íƒ€ì¼ */
#select-male.focused {
    background-color: #EFF6FF; /* bg-blue-100 */
    border-color: #60A5FA; /* border-blue-400 */
    box-shadow: 0 0 0 2px #BFDBFE; /* ring-2 ring-blue-300 */
}
#select-female.focused {
    background-color: #FFF1F2; /* bg-pink-100 */
    border-color: #F472B6; /* border-pink-400 */
    box-shadow: 0 0 0 2px #FBCFE8; /* ring-2 ring-pink-300 */
}
// js/scenarios.js

// -----------------------------------------------------------------------------
// ìƒì• ì£¼ê¸° ì´ë²¤íŠ¸ (LIFECYCLE_EVENTS)
// -----------------------------------------------------------------------------
// íŠ¹ì • ë‚˜ì´(ê°œì›” ìˆ˜)ì— ë„ë‹¬í•˜ë©´ *ë°˜ë“œì‹œ* ë°œìƒí•˜ëŠ” ì´ë²¤íŠ¸ì…ë‹ˆë‹¤.
// -----------------------------------------------------------------------------
const LIFECYCLE_EVENTS = {
    // 20ì„¸ (ì‹œì‘)
    240: {
        id: "START_GAME",
        title: "ìŠ¤ë¬´ì‚´, ì¸ìƒì˜ ì‹œì‘!",
        text: "ì¸ìƒì˜ ì²« ë²ˆì§¸ ê°ˆë¦¼ê¸¸ì…ë‹ˆë‹¤. ë‹¹ì‹ ì˜ 20ëŒ€ ì´ˆë°˜ì„ ì–´ë–»ê²Œ ë³´ë‚´ì‹œê² ìŠµë‹ˆê¹Œ?",
        choices: [
            { text: "ë¶€ëª¨ë‹˜ ëŒì—ì„œ ìš©ëˆ ë°›ê¸°", action: "START_ALLOWANCE" },
            { text: "ì•„ë¥´ë°”ì´íŠ¸ë¡œ ìƒí™œë¹„ ë²Œê¸°", action: "START_PART_TIME" },
            { text: "ë¯¸ë˜ë¥¼ ìœ„í•´ ê³µë¶€ì— ì „ë…í•˜ê¸°", action: "START_STUDYING" }
        ]
    },
    // 25ì„¸ (ì§ì—… ì„ íƒ)
    300: {
        id: "GET_JOB",
        title: "ì²« ì§ì¥ì„ êµ¬í•  ì‹œê°„ì…ë‹ˆë‹¤!",
        text: "ë‹¹ì‹ ì˜ 20ëŒ€ ì´ˆë°˜ ë…¸ë ¥ì— ë”°ë¼ ì„ íƒì§€ê°€ ë‹¬ë¼ì¡ŒìŠµë‹ˆë‹¤. ì–´ë–¤ ì§ì—…ì„ ì„ íƒí•˜ì‹œê² ìŠµë‹ˆê¹Œ?",
        // 'condition' í•¨ìˆ˜ëŠ” ì´ ì´ë²¤íŠ¸ê°€ íŠ¸ë¦¬ê±°ë  ë•Œ í˜¸ì¶œë©ë‹ˆë‹¤.
        // í”Œë ˆì´ì–´ì˜ ìƒíƒœ(state)ì— ë”°ë¼ ì„ íƒì§€ë¥¼ ë™ì ìœ¼ë¡œ ë³€ê²½í•©ë‹ˆë‹¤.
        condition: (state) => {
            let choices = [
                { text: "ì‚¬ë¬´ì§ (ì›” 250ë§Œ)", action: "JOB_OFFICE" },
                { text: "ì„œë¹„ìŠ¤ì§ (ì›” 230ë§Œ)", action: "JOB_SERVICE" },
                { text: "í”„ë¦¬ëœì„œ (ì›” 200ë§Œ~300ë§Œ ë³€ë™)", action: "JOB_FREELANCER" }
            ];
            
            // 'ê³µë¶€'ë¥¼ ì„ íƒí–ˆë˜(study: true) í”Œë ˆì´ì–´ì—ê²Œë§Œ 'ì „ë¬¸ì§' ì„ íƒì§€ê°€ ë³´ì…ë‹ˆë‹¤.
            if (state.flags.study) {
                choices.push({ text: "ì „ë¬¸ì§ (ì›” 400ë§Œ)", action: "JOB_PROFESSIONAL" });
            }
            // 'ì•Œë°”'ë¥¼ í–ˆë˜(partTime: true) í”Œë ˆì´ì–´ì—ê²Œë§Œ 'ì°½ì—…' ì„ íƒì§€ê°€ ë³´ì…ë‹ˆë‹¤.
            if (state.flags.partTime) {
                choices.push({ text: "ì‘ì€ ê°€ê²Œ ì°½ì—… (ì´ˆê¸° ë¹„ìš© 5000ë§Œ)", action: "JOB_ENTREPRENEUR" });
            }
            return { choices: choices }; // ë³€ê²½ëœ ì„ íƒì§€ë¥¼ ë°˜í™˜
        }
    },
    // 30ì„¸ (ê²°í˜¼)
    360: {
        id: "GET_MARRIED",
        title: "ê²°í˜¼ì„ ìƒê°í•  ë‚˜ì´",
        text: "ì¸ìƒì˜ ì¤‘ëŒ€ì‚¬ì…ë‹ˆë‹¤. ê²°í˜¼í•˜ì‹œê² ìŠµë‹ˆê¹Œ?",
        choices: [
            { text: "ê²°í˜¼í•œë‹¤ (ë¹„ìš© 3000ë§Œ)", action: "MARRIAGE_YES" },
            { text: "ì•„ì§ì€ í˜¼ìê°€ ì¢‹ë‹¤", action: "MARRIAGE_NO" }
        ]
    },
    // 40ì„¸ (ìë…€ êµìœ¡ / ë¶€ëª¨ë‹˜ ê°„ë³‘)
    480: {
        id: "MID_LIFE_CHOICE",
        title: "40ì„¸, ì‚¶ì˜ ë¬´ê²Œ",
        text: "ìë…€ê°€ ì¤‘í•™ìƒì´ ë˜ì–´ í•™ì›ë¹„ê°€ ê³ ë¯¼ë˜ê³ , ë¶€ëª¨ë‹˜ë„ ì—°ë¡œí•˜ì…”ì„œ ê±±ì •ì…ë‹ˆë‹¤.",
        // 'condition' í•¨ìˆ˜ë¡œ í”Œë ˆì´ì–´ ìƒíƒœ(ê²°í˜¼ ì—¬ë¶€)ì— ë”°ë¼ ë‹¤ë¥¸ ì´ë²¤íŠ¸ë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤.
        condition: (state) => {
            if (state.flags.married) {
                // ê²°í˜¼í•œ ê²½ìš° -> ìë…€ í•™ì›
                return {
                    title: "ìë…€ êµìœ¡ ë¬¸ì œ",
                    text: "ìë…€ê°€ ì¤‘í•™ìƒì´ ë˜ì—ˆìŠµë‹ˆë‹¤. í•™ì›ì— ë³´ë‚´ì‹œê² ìŠµë‹ˆê¹Œ?",
                    choices: [
                        { text: "ì‚¬êµìœ¡ ì‹œì‘ (ì›” 30ë§Œ ì§€ì¶œ)", action: "CHILD_CARE_YES" },
                        { text: "ì•„ì§ì€ ê´œì°®ë‹¤", action: "CHILD_CARE_NO" }
                    ]
                };
            } else {
                // ë¯¸í˜¼ì¸ ê²½ìš° -> ë¶€ëª¨ë‹˜ ê°„ë³‘
                return {
                    title: "ë¶€ëª¨ë‹˜ ê°„ë³‘ ë¬¸ì œ",
                    text: "ì—°ë¡œí•˜ì‹  ë¶€ëª¨ë‹˜ê»˜ì„œ í¸ì°®ìœ¼ì‹­ë‹ˆë‹¤. ê°„ë³‘ë¹„ ì§€ì›ì´ í•„ìš”í•´ ë³´ì…ë‹ˆë‹¤.",
                    choices: [
                        { text: "ê°„ë³‘ë¹„ ì§€ì› (ì›” 50ë§Œ ì§€ì¶œ)", action: "PARENT_CARE_YES" },
                        { text: "ì§€ê¸ˆì€ ì—¬ìœ ê°€ ì—†ë‹¤", action: "PARENT_CARE_NO" }
                    ]
                };
            }
        }
    },
    // 50ì„¸ (ìë…€ ëŒ€í•™ / ë‚´ ì§‘ ë§ˆë ¨)
    600: {
        id: "LATE_LIFE_CHOICE",
        title: "50ì„¸, ì¸ìƒì˜ ì „í™˜ì ",
        text: "ìë…€ê°€ ëŒ€í•™ì— ê°€ê±°ë‚˜, í˜¹ì€ ë‚´ ì§‘ ë§ˆë ¨ì˜ ë§ˆì§€ë§‰ ê¸°íšŒì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.",
        condition: (state) => {
            if (state.flags.married) {
                // ê²°í˜¼í•œ ê²½ìš° -> ìë…€ ëŒ€í•™ ë“±ë¡ê¸ˆ
                return {
                    title: "ìë…€ ëŒ€í•™ ë“±ë¡ê¸ˆ",
                    text: "ìë…€ê°€ ëŒ€í•™êµì— í•©ê²©í–ˆìŠµë‹ˆë‹¤! ë“±ë¡ê¸ˆ 1000ë§Œì›ì„ ë‚´ì¤˜ì•¼ í•©ë‹ˆë‹¤.",
                    choices: [
                        { text: "ë“±ë¡ê¸ˆì„ ë‚´ì¤€ë‹¤ (1000ë§Œ ì§€ì¶œ)", action: "COLLEGE_YES" },
                        { text: "í•™ìê¸ˆ ëŒ€ì¶œì„ ë°›ìœ¼ë¼ê³  í•œë‹¤", action: "COLLEGE_NO" }
                    ]
                };
            } else {
                // ë¯¸í˜¼ì¸ ê²½ìš° -> ë‚´ ì§‘ ë§ˆë ¨ (ë˜ëŠ” ì´ì‚¬)
                return {
                    title: "ë‚´ ì§‘ ë§ˆë ¨ì˜ ê¿ˆ",
                    text: "ì•ˆì •ì ì¸ ë…¸í›„ë¥¼ ìœ„í•´ ë‚´ ì§‘ ë§ˆë ¨(ë˜ëŠ” ì´ì‚¬)ì„ ê³ ë ¤í•´ë´…ë‹ˆë‹¤.",
                    choices: [
                        { text: "ì‘ì€ ì•„íŒŒíŠ¸ ë§¤ìˆ˜ (3ì–µ ì§€ì¶œ)", action: "BUY_HOUSE_SMALL" },
                        { text: "ì´ëŒ€ë¡œ ë§Œì¡±í•œë‹¤", action: "BUY_HOUSE_NO" }
                    ]
                };
            }
        }
    },
    // 60ì„¸ (ì€í‡´)
    720: {
        id: "RETIREMENT",
        title: "ì€í‡´í•  ì‹œê°„",
        text: "ì •ë…„ì…ë‹ˆë‹¤. ì§ì¥ì—ì„œ ì€í‡´í•©ë‹ˆë‹¤. ì€í‡´ í›„ ê³„íšì´ ìˆìœ¼ì‹ ê°€ìš”?",
        choices: [
            { text: "ì€í‡´í•œë‹¤ (ì›” ìˆ˜ì… 0)", action: "RETIRE_YES" },
            { text: "ì´‰íƒì§ìœ¼ë¡œ ê³„ì† ì¼í•œë‹¤ (ìˆ˜ì… 50% ê°ì†Œ)", action: "RETIRE_PART_TIME" }
        ]
    },
    // 65ì„¸ (êµ­ë¯¼ì—°ê¸ˆ ìˆ˜ë ¹)
    780: {
        id: "PENSION",
        title: "êµ­ë¯¼ì—°ê¸ˆ ìˆ˜ë ¹ ê°œì‹œ",
        text: "ê·¸ë™ì•ˆ ë‚©ë¶€í–ˆë˜ êµ­ë¯¼ì—°ê¸ˆì„ ìˆ˜ë ¹í•  ë‚˜ì´ê°€ ë˜ì—ˆìŠµë‹ˆë‹¤.",
        choices: [
            { text: "ì—°ê¸ˆ ìˆ˜ë ¹ ì‹œì‘ (ì›” 150ë§Œ ìˆ˜ì…)", action: "PENSION_START" }
        ]
    }
};

// -----------------------------------------------------------------------------
// ëœë¤ ì´ë²¤íŠ¸ (RANDOM_EVENTS)
// -----------------------------------------------------------------------------
// ë§¤ì›” `RANDOM_EVENT_PROBABILITY` (ê¸°ë³¸ 15%) í™•ë¥ ë¡œ ë°œìƒí•˜ëŠ” ì´ë²¤íŠ¸ì…ë‹ˆë‹¤.
// 'type' (good, bad, normal)ì— ë”°ë¼ ë¡œê·¸ ìƒ‰ìƒì´ ë‹¬ë¼ì§‘ë‹ˆë‹¤.
// -----------------------------------------------------------------------------
const RANDOM_EVENTS = [
    // -- ì†Œë¹„ ì´ë²¤íŠ¸ --
    {
        id: "BUY_LUXURY_BAG",
        type: "normal",
        title: "ìœ í–‰í•˜ëŠ” ëª…í’ˆ ê°€ë°©",
        text: "ìµœì‹  ìœ í–‰í•˜ëŠ” ëª…í’ˆ ê°€ë°©ì´ ëˆˆì— ì•„ë¥¸ê±°ë¦½ë‹ˆë‹¤. í•˜ë‚˜ êµ¬ë§¤í•˜ì‹œê² ìŠµë‹ˆê¹Œ?",
        choices: [
            { text: "êµ¬ë§¤í•œë‹¤ (500ë§Œ ì§€ì¶œ)", action: "BUY_LUXURY_YES" },
            { text: "ì°¸ëŠ”ë‹¤", action: "BUY_LUXURY_NO" }
        ]
    },
    {
        id: "NEW_CAR",
        type: "normal",
        title: "ì‹ ì°¨ êµ¬ì… ê¸°íšŒ",
        text: "ë§ˆìŒì— ì™ ë“œëŠ” ì‹ ì°¨ê°€ ì¶œì‹œë˜ì—ˆìŠµë‹ˆë‹¤. ì°¨ë¥¼ ë°”ê¾¸ì‹œê² ìŠµë‹ˆê¹Œ?",
        choices: [
            { text: "ìƒˆ ì°¨ë¥¼ êµ¬ë§¤í•œë‹¤ (3000ë§Œ ì§€ì¶œ)", action: "BUY_CAR_YES" },
            { text: "ì•„ì§ì€ ë•Œê°€ ì•„ë‹ˆë‹¤", action: "BUY_CAR_NO" }
        ]
    },
    {
        id: "VACATION",
        type: "normal",
        title: "ì—¬ë¦„ íœ´ê°€ ê³„íš",
        text: "ì—´ì‹¬íˆ ì¼í•œ ë‹¹ì‹ , ë– ë‚˜ì•¼ì£ ! í•´ì™¸ ì—¬í–‰ì„ ê°€ì‹œê² ìŠµë‹ˆê¹Œ?",
        choices: [
            { text: "ìœ ëŸ½ìœ¼ë¡œ ë– ë‚œë‹¤ (400ë§Œ ì§€ì¶œ)", action: "VACATION_EUROPE" },
            { text: "ë™ë‚¨ì•„ì—ì„œ íœ´ì–‘í•œë‹¤ (150ë§Œ ì§€ì¶œ)", action: "VACATION_ASIA" },
            { text: "ì§‘ì—ì„œ ì‰°ë‹¤", action: "VACATION_STAY" }
        ]
    },

    // -- íˆ¬ì ì´ë²¤íŠ¸ --
    {
        id: "STOCK_OPPORTUNITY",
        type: "normal",
        title: "ì£¼ì‹ íˆ¬ì ê¸°íšŒ",
        text: "ìœ ë§í•´ ë³´ì´ëŠ” ê¸°ìˆ ì£¼(A)ì™€ ì•ˆì •ì ì¸ ë°°ë‹¹ì£¼(B)ê°€ ìˆìŠµë‹ˆë‹¤. íˆ¬ìí•˜ì‹œê² ìŠµë‹ˆê¹Œ?",
        choices: [
            { text: "A ê¸°ìˆ ì£¼ì— 1000ë§Œ íˆ¬ì", action: "STOCK_TECH" },
            { text: "B ë°°ë‹¹ì£¼ì— 1000ë§Œ íˆ¬ì", action: "STOCK_DIVIDEND" },
            { text: "íˆ¬ìëŠ” ìœ„í—˜í•˜ë‹¤", action: "STOCK_NO" }
        ]
    },
    {
        id: "STOCK_OPPORTUNITY_2",
        type: "normal",
        title: "ì£¼ì‹ ì‹œì¥ í˜¸í™©!",
        text: "ì£¼ì‹ ì‹œì¥ì´ ì „ë°˜ì ìœ¼ë¡œ ìƒìŠ¹ì„¸ì…ë‹ˆë‹¤. ì´ ê¸°íšŒì— íˆ¬ìê¸ˆì„ ëŠ˜ë¦¬ì‹œê² ìŠµë‹ˆê¹Œ?",
        choices: [
            { text: "ê°€ì§„ í˜„ê¸ˆì˜ 20% ì¶”ê°€ íˆ¬ì", action: "STOCK_MORE" },
            { text: "ì§€ê¸ˆì´ íŒ” ë•Œ! (íˆ¬ìê¸ˆ 50% í˜„ê¸ˆí™”)", action: "STOCK_SELL" },
            { text: "ê´€ë§í•œë‹¤", action: "STOCK_HOLD" }
        ]
    },
    {
        id: "PROPERTY_OPPORTUNITY",
        type: "normal",
        title: "ë¶€ë™ì‚° íˆ¬ì ê¸°íšŒ",
        text: "ìˆ˜ë„ê¶Œ ì™¸ê³½ì— ì†Œí˜• ì˜¤í”¼ìŠ¤í…”(8000ë§Œ)ì´ ê¸‰ë§¤ë¡œ ë‚˜ì™”ìŠµë‹ˆë‹¤. ë§¤ìˆ˜í•˜ì‹œê² ìŠµë‹ˆê¹Œ?",
        choices: [
            { text: "ë§¤ìˆ˜í•œë‹¤ (8000ë§Œ ì§€ì¶œ, ë¶€ë™ì‚° ìì‚° +1ì–µ)", action: "PROPERTY_BUY_OFFICE" },
            { text: "ê´€ì‹¬ ì—†ë‹¤", action: "PROPERTY_NO" }
        ]
    },

    // -- í–‰ìš´ / ë¶ˆìš´ ì´ë²¤íŠ¸ --
    {
        id: "LOTTERY_WIN",
        type: "good",
        title: "ë³µê¶Œ ë‹¹ì²¨!",
        text: "ë¬´ì‹¬ì½” ìƒ€ë˜ ë³µê¶Œì´ 3ë“±ì— ë‹¹ì²¨ë˜ì—ˆìŠµë‹ˆë‹¤!",
        choices: [
            { text: "ì•¼í˜¸! (í˜„ê¸ˆ 100ë§Œ íšë“)", action: "LOTTERY_WIN_SMALL" }
        ]
    },
    {
        id: "BONUS",
        type: "good",
        title: "ê¹œì§ ë³´ë„ˆìŠ¤",
        text: "íšŒì‚¬ì—ì„œ ìš°ìˆ˜ ì‚¬ì›ìœ¼ë¡œ ì„ ì •ë˜ì–´ ë³´ë„ˆìŠ¤ë¥¼ ë°›ì•˜ìŠµë‹ˆë‹¤!",
        choices: [
            { text: "ê°ì‚¬í•©ë‹ˆë‹¤! (ì›”ê¸‰ë§Œí¼ íšë“)", action: "BONUS_GET" }
        ]
    },
    {
        id: "HEALTH_ISSUE",
        type: "bad",
        title: "ê±´ê°• ì ì‹ í˜¸",
        text: "ê°‘ì‘ìŠ¤ëŸ¬ìš´ ê±´ê°• ë¬¸ì œë¡œ ë³‘ì›ë¹„ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.",
        choices: [
            { text: "ì–´ì©” ìˆ˜ ì—†ì§€... (200ë§Œ ì§€ì¶œ)", action: "HEALTH_PAY" }
        ]
    },
    {
        id: "SCAM",
        type: "bad",
        title: "ê¸ˆìœµ ì‚¬ê¸° ì£¼ì˜",
        text: "'ì›ê¸ˆ ë³´ì¥, ì›” 20% ìˆ˜ìµ!' ìˆ˜ìƒí•œ íˆ¬ì ê¶Œìœ  ì „í™”ê°€ ê±¸ë ¤ì™”ìŠµë‹ˆë‹¤.",
        choices: [
            { text: "ì´ëŸ° ê¸°íšŒë¥¼ ë†“ì¹  ìˆ˜ ì—†ì§€! (1000ë§Œ íˆ¬ì)", action: "SCAM_YES" },
            { text: "ë§ë„ ì•ˆ ë˜ëŠ” ì†Œë¦¬ (ë¬´ì‹œí•œë‹¤)", action: "SCAM_NO" }
        ]
    },
    
    // -- 20ëŒ€ì—ë§Œ ë°œìƒí•˜ëŠ” ì´ë²¤íŠ¸ --
    {
        id: "DATING",
        type: "normal",
        title: "ì—°ì•  ì‹œì‘",
        text: "ë§ˆìŒì´ ì˜ ë§ëŠ” ìƒëŒ€ë¥¼ ë§Œë‚¬ìŠµë‹ˆë‹¤. ì—°ì• ë¥¼ ì‹œì‘í•˜ì‹œê² ìŠµë‹ˆê¹Œ?",
        choices: [
            { text: "ì—°ì•  ì‹œì‘! (ì›” 20ë§Œ ë°ì´íŠ¸ ë¹„ìš©)", action: "DATING_START" },
            { text: "ì§€ê¸ˆì€ ì—°ì• í•  ë•Œê°€ ì•„ë‹ˆë‹¤", action: "DATING_NO" }
        ],
        // 'condition' í•¨ìˆ˜ë¡œ 20ëŒ€(240~359ê°œì›”)ì—ë§Œ ë“±ì¥í•˜ë„ë¡ ì„¤ì •
        condition: (state) => state.ageInMonths < 360 
    }
];
// js/game.js

/**
 * ì–µë§Œì¥ìê°€ ë˜ê³  ì‹¶ì–´! (v2.28)
 * ê²Œì„ì˜ í•µì‹¬ ë¡œì§ì„ ê´€ë¦¬í•˜ëŠ” Game í´ë˜ìŠ¤
 * v2.27ì˜ ê²°í˜¼ ì´ë²¤íŠ¸ ë©ˆì¶¤ ë²„ê·¸ ìˆ˜ì •ë¨.
 */
class Game {
    constructor() {
        // --- ê²Œì„ ìƒíƒœ (State) ---
        this.state = {
            playerName: "í”Œë ˆì´ì–´",
            gender: "female",
            ageInMonths: 240, // 20ì„¸ (240ê°œì›”)
            cash: 10000000,    // í˜„ê¸ˆ: 1000ë§Œ
            stocks: 0,          // ì£¼ì‹ ìì‚°
            property: 0,        // ë¶€ë™ì‚° ìì‚°
            monthlyIncome: 0,   // ì›” ìˆ˜ì…
            monthlyExpenses: 200000, // ì›” ê³ ì • ì§€ì¶œ (ê¸°ë³¸ 20ë§Œ)
            job: "ë¬´ì§",
            happiness: 50,
            health: 80,
            flags: { // íŠ¹ë³„í•œ ìƒíƒœ í”Œë˜ê·¸
                study: false,
                partTime: false,
                married: false,
                dating: false,
                childCare: false,
                parentCare: false,
                retired: false,
                pension: false,
            }
        };

        // --- ê²Œì„ ì„¤ì • (Config) ---
        this.GAME_SPEED = 200; // 1ê°œì›” ì§„í–‰ ì†ë„ (ms)
        this.END_AGE_MONTHS = 80 * 12; // 80ì„¸ (960ê°œì›”)
        this.RANDOM_EVENT_PROBABILITY = 0.15; // ë§¤ì›” ëœë¤ ì´ë²¤íŠ¸ ë°œìƒ í™•ë¥  (15%)
        this.AI_IMAGE_GENERATION_INTERVAL = 60; // 5ë…„(60ê°œì›”)ë§ˆë‹¤ ìºë¦­í„° ì´ë¯¸ì§€ ìƒì„±

        // --- ë‚´ë¶€ ê´€ë¦¬ ë³€ìˆ˜ ---
        this.gameLoopInterval = null;
        this.isPaused = false;
        this.eventQueue = []; // ì²˜ë¦¬í•´ì•¼ í•  ì´ë²¤íŠ¸ë¥¼ ìŒ“ì•„ë‘ëŠ” í

        // --- DOM ìš”ì†Œ ìºì‹± ---
        // (ê° DOM ìš”ì†Œë“¤ì„ ì°¾ì•„ì„œ ë³€ìˆ˜ì— í• ë‹¹)
        this.dom = {
            startScreen: document.getElementById('start-screen'),
            gameContainer: document.getElementById('game-container'),
            gameOverScreen: document.getElementById('game-over-screen'),
            
            playerNameInput: document.getElementById('player-name'),
            nameError: document.getElementById('name-error'),
            maleButton: document.getElementById('select-male'),
            femaleButton: document.getElementById('select-female'),
            startButton: document.getElementById('start-button'),
            restartButton: document.getElementById('restart-button'),

            clock: document.getElementById('clock'),
            progressBar: document.getElementById('progress-bar'),
            progressAge: document.getElementById('progress-age'),
            pauseButton: document.getElementById('pause-button'),
            gameStatus: document.getElementById('game-status'),
            eventLog: document.getElementById('event-log'),

            // ìºë¦­í„° & ì¬ì •
            characterImageContainer: document.getElementById('character-image-container'),
            characterLoading: document.getElementById('character-loading'),
            characterImage: document.getElementById('character-image'),
            characterName: document.getElementById('character-name'),
            characterJob: document.getElementById('character-job'),
            totalAssets: document.getElementById('total-assets'),
            cashAssets: document.getElementById('cash-assets'),
            stockAssets: document.getElementById('stock-assets'),
            propertyAssets: document.getElementById('property-assets'),
            monthlyIncome: document.getElementById('monthly-income'),
            monthlyExpenses: document.getElementById('monthly-expenses'),
            netIncome: document.getElementById('net-income'),

            // ëª¨ë‹¬
            modal: document.getElementById('modal'),
            modalTitle: document.getElementById('modal-title'),
            modalText: document.getElementById('modal-text'),
            modalChoices: document.getElementById('modal-choices'),

            // ê²Œì„ ì˜¤ë²„
            gameOverTitle: document.getElementById('game-over-title'),
            gameOverText: document.getElementById('game-over-text'),
            finalAssets: document.getElementById('final-assets'),
        };

        // --- API í‚¤ (ë‚˜ë…¸ë°”ë‚˜ë‚˜) ---
        this.NANO_BANANA_API_KEY = ""; // í™˜ê²½ì— ë”°ë¼ ìë™ ì£¼ì…ë  ìˆ˜ ìˆìŒ
    }

    // =========================================================================
    // ê²Œì„ ì´ˆê¸°í™” ë° ë£¨í”„
    // =========================================================================

    /**
     * ê²Œì„ ì´ˆê¸°í™”: ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.
     */
    init() {
        this.dom.startButton.addEventListener('click', () => this.startGame());
        this.dom.restartButton.addEventListener('click', () => window.location.reload());
        this.dom.pauseButton.addEventListener('click', () => this.togglePause());
        this.dom.maleButton.addEventListener('click', () => this.selectGender('male'));
        this.dom.femaleButton.addEventListener('click', () => this.selectGender('female'));

        this.dom.playerNameInput.addEventListener('input', () => {
            if (this.dom.playerNameInput.value.trim()) {
                this.dom.nameError.classList.add('hidden');
            }
        });
    }

    /**
     * ì„±ë³„ ì„ íƒ ì²˜ë¦¬
     * @param {string} gender 'male' ë˜ëŠ” 'female'
     */
    selectGender(gender) {
        this.state.gender = gender;
        if (gender === 'male') {
            this.dom.maleButton.classList.add('focused');
            this.dom.femaleButton.classList.remove('focused');
        } else {
            this.dom.femaleButton.classList.add('focused');
            this.dom.maleButton.classList.remove('focused');
        }
    }

    /**
     * ê²Œì„ ì‹œì‘
     */
    startGame() {
        const playerName = this.dom.playerNameInput.value.trim();

        // ì´ë¦„ ìœ íš¨ì„± ê²€ì‚¬ (alert() ëŒ€ì‹  UI ì˜¤ë¥˜ ë©”ì‹œì§€ ì‚¬ìš©)
        if (!playerName) {
            this.dom.nameError.classList.remove('hidden');
            this.dom.playerNameInput.focus();
            return; // ê²Œì„ ì‹œì‘ ì¤‘ë‹¨
        }

        this.state.playerName = playerName;
        this.dom.characterName.innerText = playerName;

        this.dom.startScreen.classList.add('hidden');
        this.dom.gameContainer.classList.remove('hidden');

        this.generateCharacterImage();
        this.updateUI();
        this.addLog("20ì„¸, ì¸ìƒì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤.", "event");
        this.enqueueEvent(LIFECYCLE_EVENTS[240]); // 20ì„¸ ì´ë²¤íŠ¸
        this.startGameLoop();
    }

    /**
     * ë©”ì¸ ê²Œì„ ë£¨í”„ ì‹œì‘
     */
    startGameLoop() {
        if (this.gameLoopInterval) {
            clearInterval(this.gameLoopInterval);
        }
        
        this.gameLoopInterval = setInterval(() => {
            if (!this.isPaused) {
                this.nextMonth();
            }
        }, this.GAME_SPEED);
    }

    /**
     * ê²Œì„ ë£¨í”„ ì •ì§€
     */
    stopGameLoop() {
        clearInterval(this.gameLoopInterval);
        this.gameLoopInterval = null;
    }

    /**
     * ì¼ì‹œì •ì§€ / ì¬ê°œ í† ê¸€
     */
    togglePause() {
        this.isPaused = !this.isPaused;
        if (this.isPaused) {
            this.dom.pauseButton.innerText = "ê²Œì„ ì¬ê°œ";
            this.dom.gameStatus.innerText = "ì¼ì‹œì •ì§€ë¨";
        } else {
            this.dom.pauseButton.innerText = "ì¼ì‹œì •ì§€";
            this.dom.gameStatus.innerText = "ê²Œì„ ì§„í–‰ ì¤‘...";
        }
    }

    /**
     * ê²Œì„ ì¬ê°œ (ëª¨ë‹¬ì´ ë‹«í ë•Œ í˜¸ì¶œë¨)
     */
    playGame() {
        this.isPaused = false;
        this.dom.modal.classList.add('hidden');
        this.dom.pauseButton.innerText = "ì¼ì‹œì •ì§€";
        this.dom.gameStatus.innerText = "ê²Œì„ ì§„í–‰ ì¤‘...";
        
        // v2.27 ë²„ê·¸ ìˆ˜ì •:
        // ë§Œì•½ íì— ì´ë²¤íŠ¸ê°€ ë˜ ë‚¨ì•„ìˆë‹¤ë©´(ì˜ˆ: ê²°í˜¼ -> ì£¼ê±° ì—°ì‡„ ì´ë²¤íŠ¸)
        // ë£¨í”„ë¥¼ ë°”ë¡œ ëŒë¦¬ì§€ ì•Šê³ , ë‹¤ìŒ í‹±ì— ì²˜ë¦¬ë˜ë„ë¡ nextMonthë¥¼ í•œ ë²ˆ ë” í˜¸ì¶œ.
        // ê·¸ë ‡ì§€ ì•Šìœ¼ë©´(íê°€ ë¹„ì—ˆìœ¼ë©´) ë£¨í”„ë¥¼ ì¬ì‹œì‘.
        if (this.eventQueue.length > 0) {
            // íì— ë‚¨ì€ ì´ë²¤íŠ¸ë¥¼ ì¦‰ì‹œ ì²˜ë¦¬í•˜ê¸° ìœ„í•´ nextMonth() í˜¸ì¶œ
            // (ì´ëŸ¬ë©´ ë©ˆì¶¤ ìƒíƒœë¡œ ëª¨ë‹¬ì´ ë°”ë¡œ ë‹¤ì‹œ ëœ¸)
             setTimeout(() => this.nextMonth(), 50); // ì‚´ì§ ë”œë ˆì´ë¥¼ ì¤Œ
        } else {
            // íê°€ ë¹„ì—ˆìœ¼ë©´ ê²Œì„ ë£¨í”„ ì¬ì‹œì‘
            this.startGameLoop();
        }
    }

    /**
     * 1ê°œì›” ì§„í–‰ (ê²Œì„ì˜ í•µì‹¬ ë¡œì§)
     */
    nextMonth() {
        // v2.27 ìˆ˜ì •: ì´ë¯¸ ì¼ì‹œì •ì§€ ìƒíƒœ(ëª¨ë‹¬ì´ ë–  ìˆê±°ë‚˜, ë– ì•¼ í• )ë©´ 
        //            ì›”ì„ ì§„í–‰ì‹œí‚¤ì§€ ì•ŠìŒ. (playGame()ì´ í˜¸ì¶œë˜ì–´ì•¼ë§Œ í’€ë¦¼)
        if (this.isPaused) {
            // íì— ì´ë²¤íŠ¸ê°€ ìˆëŠ”ë° ì•„ì§ ëª¨ë‹¬ì´ ì•ˆ ë–´ë‹¤ë©´?
            if (this.eventQueue.length > 0) {
                this.processEventQueue();
            }
            return;
        }

        // ---
        // (ê²Œì„ì´ ì§„í–‰ ì¤‘ì¼ ë•Œë§Œ ì•„ë˜ ë¡œì§ ì‹¤í–‰)
        // ---

        // 1. ë‚˜ì´ ì¦ê°€
        this.state.ageInMonths++;
        
        // 2. ì›”ë³„ ìˆ˜ì…/ì§€ì¶œ ì •ì‚°
        this.state.cash += this.state.monthlyIncome;
        this.state.cash -= this.state.monthlyExpenses;

        // 3. ì£¼ì‹ ìì‚° ë³€ë™ (ê°„ë‹¨í•œ ì‹œë®¬ë ˆì´ì…˜)
        if (this.state.stocks > 0) {
            const randomChange = (Math.random() * 0.15) - 0.05;
            const changeAmount = Math.round(this.state.stocks * randomChange);
            this.state.stocks += changeAmount;
            
            // 1ë…„ì— í•œ ë²ˆ ì •ë„ë§Œ ë¡œê·¸ í‘œì‹œ (ë„ˆë¬´ ë§ìœ¼ë©´ ì§€ì €ë¶„í•¨)
            if (this.state.ageInMonths % 12 === 0) {
                 if (changeAmount > 0) {
                    this.addLog(`íˆ¬ì ìì‚°ì´ ì—°ê°„ ${this.formatCurrency(changeAmount * 12)} ë³€ë™í–ˆìŠµë‹ˆë‹¤.`, "good");
                 } else if (changeAmount < 0) {
                    this.addLog(`íˆ¬ì ìì‚°ì´ ì—°ê°„ ${this.formatCurrency(Math.abs(changeAmount) * 12)} ë³€ë™í–ˆìŠµë‹ˆë‹¤.`, "bad");
                 }
            }
        }

        // 4. ì´ë²¤íŠ¸ ì²˜ë¦¬
        // 4a. ìƒì• ì£¼ê¸° ì´ë²¤íŠ¸ í™•ì¸
        const lifecycleEvent = LIFECYCLE_EVENTS[this.state.ageInMonths];
        if (lifecycleEvent) {
            this.enqueueEvent(lifecycleEvent); // íì— ì¶”ê°€
        } else {
            // 4b. ëœë¤ ì´ë²¤íŠ¸ í™•ì¸ (ìƒì• ì£¼ê¸° ì´ë²¤íŠ¸ê°€ ì—†ì„ ë•Œë§Œ)
            if (Math.random() < this.RANDOM_EVENT_PROBABILITY) {
                this.triggerRandomEvent();
            }
        }

        // 4c. ì´ë²¤íŠ¸ í ì²˜ë¦¬ (v2.27)
        // ì´ë²ˆ ë‹¬ì— ì²˜ë¦¬í•  ì´ë²¤íŠ¸ê°€ ìˆë‹¤ë©´ (ìƒì• ì£¼ê¸° or ëœë¤)
        if (this.eventQueue.length > 0) {
            this.processEventQueue();
        }


        // 5. ìºë¦­í„° ì´ë¯¸ì§€ ê°±ì‹  (5ë…„ë§ˆë‹¤)
        if (this.state.ageInMonths % this.AI_IMAGE_GENERATION_INTERVAL === 0) {
            this.generateCharacterImage();
        }

        // 6. UI ì—…ë°ì´íŠ¸
        this.updateUI();

        // 7. ê²Œì„ ì¢…ë£Œ ì¡°ê±´ í™•ì¸
        if (this.state.cash < -10000000) { // íŒŒì‚° (í˜„ê¸ˆ -1000ë§Œ)
            this.gameOver("íŒŒì‚°");
        } else if (this.state.ageInMonths >= this.END_AGE_MONTHS) { // 80ì„¸ ë„ë‹¬
            this.gameOver("ì€í‡´");
        }
    }
    
    /**
     * (v2.27 ì‹ ê·œ) ì´ë²¤íŠ¸ íì—ì„œ ì´ë²¤íŠ¸ë¥¼ êº¼ë‚´ ì²˜ë¦¬
     */
    processEventQueue() {
        if (this.eventQueue.length > 0) {
            const event = this.eventQueue.shift(); // íì—ì„œ ì²« ë²ˆì§¸ ì´ë²¤íŠ¸ êº¼ë‚´ê¸°
            
            if (event) {
                // ê²Œì„ ë£¨í”„ ì •ì§€ (setInterval ìì²´ë¥¼ ë©ˆì¶”ëŠ” ê²Œ ì•„ë‹˜)
                // v2.27 ìˆ˜ì •: stopGameLoop() ëŒ€ì‹  isPaused í”Œë˜ê·¸ë§Œ ì‚¬ìš©
                this.isPaused = true; 
                this.dom.gameStatus.innerText = "ì„ íƒ ëŒ€ê¸° ì¤‘...";
                
                // ëª¨ë‹¬ì°½ í‘œì‹œ (ë¹„ë™ê¸°ì ìœ¼ë¡œ ì ì‹œ í›„)
                // (DOM ê·¸ë¦¬ê¸°ê°€ ë©ˆì¶”ëŠ” ê²ƒì„ ë°©ì§€)
                setTimeout(() => this.triggerModal(event), 50);

            } else {
                 // íì—ì„œ êº¼ëƒˆëŠ”ë° undefinedì¸ ê²½ìš° (v2.26 ë²„ê·¸ ì¼€ì´ìŠ¤)
                 // ì•„ë¬´ê²ƒë„ ì•ˆ í•¨ (ë‹¤ìŒ ë‹¬ë¡œ ì§„í–‰)
            }
        }
    }


    /**
     * ì´ë²¤íŠ¸ë¥¼ íì— ì¶”ê°€
     * @param {object} event - LIFECYCLE_EVENTS ë˜ëŠ” RANDOM_EVENTSì˜ ì´ë²¤íŠ¸ ê°ì²´
     */
    enqueueEvent(event) {
        // v2.28 ìˆ˜ì •: ì¡°ê±´(condition) í•¨ìˆ˜ê°€ ì—¬ê¸°ì„œ ì²´í¬ë˜ì–´ì•¼ í•¨.
        if (event.condition) {
            // ì¡°ê±´ í•¨ìˆ˜ê°€ trueë¥¼ ë°˜í™˜í•  ë•Œë§Œ ì´ë²¤íŠ¸ë¥¼ íì— ì¶”ê°€
            if (event.condition(this.state)) {
                 this.eventQueue.push(event);
            }
            // ì¡°ê±´ì´ falseë©´, ë¬´ì‹œ
        } else {
            // ì¡°ê±´ì´ ì—†ëŠ” ì´ë²¤íŠ¸ëŠ” í•­ìƒ íì— ì¶”ê°€
            this.eventQueue.push(event);
        }
    }

    /**
     * ëœë¤ ì´ë²¤íŠ¸ íì— ì¶”ê°€ (v2.28 ìˆ˜ì •)
     */
    triggerRandomEvent() {
        const event = RANDOM_EVENTS[Math.floor(Math.random() * RANDOM_EVENTS.length)];
        this.enqueueEvent(event); // íì— ì¶”ê°€ (enqueueEventê°€ ì¡°ê±´ ê²€ì‚¬)
    }


    /**
     * ê²Œì„ ì˜¤ë²„ ì²˜ë¦¬
     * @param {string} type - "íŒŒì‚°" ë˜ëŠ” "ì€í‡´"
     */
    gameOver(type) {
        this.stopGameLoop(); // ë©”ì¸ ë£¨í”„(setInterval) ì™„ì „ ì •ì§€
        this.isPaused = true;
        
        let title = "";
        let text = "";
        const totalAssets = this.state.cash + this.state.stocks + this.state.property;

        if (type === "íŒŒì‚°") {
            title = "íŒŒì‚°";
            text = "ë§‰ëŒ€í•œ ë¹šì„ ê°ë‹¹í•˜ì§€ ëª»í•˜ê³  íŒŒì‚°í–ˆìŠµë‹ˆë‹¤...";
        } else {
            if (totalAssets > 1000000000) title = "ì–µë§Œì¥ì";
            else if (totalAssets > 500000000) title = "ì„±ê³µí•œ ìì‚°ê°€";
            else if (totalAssets > 100000000) title = "ì•ˆì •ì ì¸ ì€í‡´";
            else if (totalAssets > 0) title = "í‰ë²”í•œ ì‹œë¯¼";
            else title = "ë¹ˆê³¤í•œ ë…¸í›„";
            
            text = `80ì„¸, ê¸´ ì¸ìƒì„ ë³´ëƒˆìŠµë‹ˆë‹¤. (${title} ì—”ë”©)`;
        }

        this.dom.gameOverTitle.innerText = title;
        this.dom.gameOverText.innerText = text;
        this.dom.finalAssets.innerText = `ìµœì¢… ìì‚°: ${this.formatCurrency(totalAssets)}`;
        this.dom.gameContainer.classList.add('hidden');
        this.dom.gameOverScreen.classList.remove('hidden');
    }

    // =========================================================================
    // ì´ë²¤íŠ¸ íŠ¸ë¦¬ê±° ë° ì²˜ë¦¬
    // =========================================================================

    /**
     * ëª¨ë‹¬ì°½ í‘œì‹œ
     * @param {object} event - í‘œì‹œí•  ì´ë²¤íŠ¸ ê°ì²´
     */
    triggerModal(event) {
        if (!event) {
            console.error("triggerModal: eventê°€ undefinedì…ë‹ˆë‹¤.");
            this.playGame(); // ì¦‰ì‹œ ê²Œì„ ì¬ê°œ
            return;
        }

        let { id, title, text, choices, condition } = event;

        // 'condition' í•¨ìˆ˜ê°€ ìˆë‹¤ë©´ ì‹¤í–‰ (v2.28: ì—¬ê¸°ì„œë„ ì‹¤í–‰)
        // (LIFECYCLE_EVENTSì˜ ë™ì  ì„ íƒì§€ ìƒì„±ìš©)
        if (condition) {
            // (ì´ë¯¸ enqueueEventì—ì„œ ì²´í¬í–ˆì§€ë§Œ, ë™ì  í…ìŠ¤íŠ¸/ì„ íƒì§€ ìƒì„±ì„ ìœ„í•´ í•œ ë²ˆ ë”)
            const conditionalEvent = condition(this.state);
            if (conditionalEvent) {
                title = conditionalEvent.title || title;
                text = conditionalEvent.text || text;
                choices = conditionalEvent.choices || choices;
            }
        }
        
        // ëª¨ë‹¬ ë‚´ìš© ì±„ìš°ê¸°
        this.dom.modalTitle.innerText = title;
        this.dom.modalText.innerText = text;
        this.dom.modalChoices.innerHTML = ""; // ê¸°ì¡´ ì„ íƒì§€ ì´ˆê¸°í™”

        // ì„ íƒì§€ ë²„íŠ¼ ìƒì„±
        choices.forEach(choice => {
            const button = document.createElement('button');
            button.className = "w-full text-left p-4 border border-gray-300 rounded-lg hover:bg-gray-100 focus:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-primary transition";
            button.innerText = choice.text;
            
            button.onclick = () => {
                this.handleChoice(id, choice.action); 
            };
            this.dom.modalChoices.appendChild(button);
        });

        // ëª¨ë‹¬ í‘œì‹œ
        this.dom.modal.classList.remove('hidden');
    }

    /**
     * í”Œë ˆì´ì–´ì˜ ì„ íƒ ì²˜ë¦¬
     * @param {string} eventId - ì´ë²¤íŠ¸ ID
     * @param {string} action - ì„ íƒí•œ ì•¡ì…˜ ID
     */
    handleChoice(eventId, action) {
        // (v2.27ì—ì„œ ìˆ˜ì •ëœ ë¡œì§ ë°˜ì˜)

        let logMsg = "";
        let logType = "default";

        // --- ì„ íƒ(action)ì— ë”°ë¼ state ë³€ê²½ ---
        switch (action) {
            // --- 20ì„¸: ì‹œì‘ ---
            case "START_ALLOWANCE":
                this.state.monthlyIncome = 300000;
                logMsg = "ë¶€ëª¨ë‹˜ ëŒì—ì„œ ìš©ëˆ 30ë§Œì›ì„ ë°›ìœ¼ë©° ìƒí™œì„ ì‹œì‘í•©ë‹ˆë‹¤.";
                break;
            case "START_PART_TIME":
                this.state.monthlyIncome = 800000;
                this.state.monthlyExpenses += 300000;
                this.state.flags.partTime = true;
                logMsg = "ì•„ë¥´ë°”ì´íŠ¸(ì›” 80ë§Œ)ë¥¼ í•˜ë©° ìì·¨(ì›” 30ë§Œ)ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤.";
                break;
            case "START_STUDYING":
                this.state.monthlyExpenses += 400000;
                this.state.flags.study = true;
                logMsg = "ë¯¸ë˜ë¥¼ ìœ„í•´ ê³µë¶€ì— ì „ë…í•©ë‹ˆë‹¤. (ì›” 40ë§Œ ì§€ì¶œ)";
                break;

            // --- 25ì„¸: ì§ì—… ---
            case "JOB_OFFICE":
                this.state.job = "ì‚¬ë¬´ì§";
                this.state.monthlyIncome = 2500000;
                logMsg = "ì‚¬ë¬´ì§(ì›” 250ë§Œ)ìœ¼ë¡œ ì»¤ë¦¬ì–´ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤.";
                break;
            case "JOB_SERVICE":
                this.state.job = "ì„œë¹„ìŠ¤ì§";
                this.state.monthlyIncome = 2300000;
                logMsg = "ì„œë¹„ìŠ¤ì§(ì›” 230ë§Œ)ìœ¼ë¡œ ì»¤ë¦¬ì–´ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤.";
                break;
            case "JOB_FREELANCER":
                this.state.job = "í”„ë¦¬ëœì„œ";
                this.state.monthlyIncome = 2500000;
                logMsg = "í”„ë¦¬ëœì„œ(ì›” í‰ê·  250ë§Œ)ë¡œ ììœ ë¡­ê²Œ ì¼í•©ë‹ˆë‹¤.";
                break;
            case "JOB_PROFESSIONAL":
                this.state.job = "ì „ë¬¸ì§";
                this.state.monthlyIncome = 4000000;
                logMsg = "ê³µë¶€ì˜ ê²°ì‹¤! ì „ë¬¸ì§(ì›” 400ë§Œ)ìœ¼ë¡œ ì»¤ë¦¬ì–´ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤.";
                logType = "good";
                break;
            case "JOB_ENTREPRENEUR":
                this.state.job = "ìì˜ì—…";
                this.state.monthlyIncome = 3000000;
                this.state.cash -= 50000000;
                logMsg = "ì°½ì—… ë¹„ìš© 5000ë§Œì›ì„ ë“¤ì—¬ ì‘ì€ ê°€ê²Œë¥¼ ì—´ì—ˆìŠµë‹ˆë‹¤. (ì›” 300ë§Œ ìˆ˜ì…)";
                logType = "event";
                break;

            // --- 30ì„¸: ê²°í˜¼ ---
            case "MARRIAGE_YES":
                this.state.cash -= 30000000;
                this.state.flags.married = true;
                logMsg = "ê²°í˜¼ì„ ì¶•í•˜í•©ë‹ˆë‹¤! (ë¹„ìš© 3000ë§Œ ì§€ì¶œ)";
                logType = "event";
                // v2.27 ë²„ê·¸ ìˆ˜ì •: ì—¬ê¸°ì„œ ë©ˆì·„ì—ˆìŒ.
                break;
            case "MARRIAGE_NO":
                logMsg = "ë…ì‹ ì˜ ì‚¶ì„ ì¦ê¸°ê¸°ë¡œ í•©ë‹ˆë‹¤.";
                break;
                
            // --- 40ì„¸: ì¤‘ë…„ ---
            case "CHILD_CARE_YES":
                this.state.monthlyExpenses += 300000;
                this.state.flags.childCare = true;
                logMsg = "ìë…€ì˜ ì‚¬êµìœ¡ì„ ì‹œì‘í•©ë‹ˆë‹¤. (ì›” 30ë§Œ ì§€ì¶œ ì¶”ê°€)";
                break;
            case "CHILD_CARE_NO":
                logMsg = "ì•„ì§ì€ ì‚¬êµìœ¡ ì—†ì´ ê´œì°®ë‹¤ê³  ìƒê°í•©ë‹ˆë‹¤.";
                break;
            case "PARENT_CARE_YES":
                this.state.monthlyExpenses += 500000;
                this.state.flags.parentCare = true;
                logMsg = "ë¶€ëª¨ë‹˜ ê°„ë³‘ë¹„ë¥¼ ì§€ì›í•©ë‹ˆë‹¤. (ì›” 50ë§Œ ì§€ì¶œ ì¶”ê°€)";
                break;
            case "PARENT_CARE_NO":
                logMsg = "ì§€ê¸ˆì€ ì—¬ìœ ê°€ ì—†ì–´ ë§ˆìŒì´ ë¬´ê²ìŠµë‹ˆë‹¤.";
                logType = "bad";
                break;
                
            // --- 50ì„¸: ì¥ë…„ ---
            case "COLLEGE_YES":
                this.state.cash -= 10000000;
                logMsg = "ìë…€ì˜ ëŒ€í•™ ë“±ë¡ê¸ˆì„ ë‚´ì£¼ì—ˆìŠµë‹ˆë‹¤. (-1000ë§Œ)";
                logType = "event";
                break;
            case "COLLEGE_NO":
                logMsg = "ìë…€ê°€ í•™ìê¸ˆ ëŒ€ì¶œì„ ë°›ì•˜ìŠµë‹ˆë‹¤.";
                break;
            case "BUY_HOUSE_SMALL":
                if (this.state.cash >= 300000000) {
                    this.state.cash -= 300000000;
                    this.state.property += 300000000;
                    logMsg = "3ì–µìœ¼ë¡œ ë‚´ ì§‘ ë§ˆë ¨ì— ì„±ê³µí–ˆìŠµë‹ˆë‹¤!";
                    logType = "good";
                } else {
                    logMsg = "í˜„ê¸ˆì´ ë¶€ì¡±í•˜ì—¬ ì§‘ì„ ì‚´ ìˆ˜ ì—†ì—ˆìŠµë‹ˆë‹¤.";
                    logType = "bad";
                }
                break;
            case "BUY_HOUSE_NO":
                logMsg = "ë‚´ ì§‘ ë§ˆë ¨ ëŒ€ì‹  í˜„ê¸ˆì„ ë³´ìœ í•˜ê¸°ë¡œ í•©ë‹ˆë‹¤.";
                break;

            // --- 60ì„¸: ì€í‡´ ---
            case "RETIRE_YES":
                this.state.job = "ì€í‡´";
                this.state.monthlyIncome = 0;
                this.state.flags.retired = true;
                logMsg = "60ì„¸, ì •ë…„ ì€í‡´í•©ë‹ˆë‹¤.";
                break;
            case "RETIRE_PART_TIME":
                this.state.job = "ì´‰íƒì§";
                this.state.monthlyIncome /= 2;
                this.state.flags.retired = true;
                logMsg = "ì´‰íƒì§ìœ¼ë¡œ ì ˆë°˜ì˜ ìˆ˜ì…ì„ ë°›ìœ¼ë©° ì¼ì„ ê³„ì†í•©ë‹ˆë‹¤.";
                break;
                
            // --- 65ì„¸: ì—°ê¸ˆ ---
            case "PENSION_START":
                this.state.monthlyIncome += 1500000;
                this.state.flags.pension = true;
                logMsg = "êµ­ë¯¼ì—°ê¸ˆ ìˆ˜ë ¹ì´ ì‹œì‘ë©ë‹ˆë‹¤. (ì›” 150ë§Œ ìˆ˜ì…)";
                logType = "good";
                break;

            // --- ëœë¤: ì†Œë¹„ ---
            case "BUY_LUXURY_YES":
                this.state.cash -= 5000000;
                logMsg = "ëª…í’ˆ ê°€ë°©ì„ êµ¬ë§¤í–ˆìŠµë‹ˆë‹¤. (-500ë§Œ)";
                break;
            case "BUY_LUXURY_NO":
                logMsg = "ëª…í’ˆ ê°€ë°©ì„ ì‚¬ì§€ ì•Šê³  ëˆì„ ì•„ê¼ˆìŠµë‹ˆë‹¤.";
                break;
            case "BUY_CAR_YES":
                this.state.cash -= 30000000;
                this.state.monthlyExpenses += 150000;
                logMsg = "ì‹ ì°¨ë¥¼ êµ¬ë§¤í–ˆìŠµë‹ˆë‹¤! (-3000ë§Œ, ì›” ìœ ì§€ë¹„ 15ë§Œ ì¶”ê°€)";
                break;
            case "BUY_CAR_NO":
                logMsg = "ì°¨ë¥¼ ë°”ê¾¸ì§€ ì•Šê³  ëˆì„ ì•„ê¼ˆìŠµë‹ˆë‹¤.";
                break;
            case "VACATION_EUROPE":
                this.state.cash -= 4000000;
                logMsg = "ìœ ëŸ½ì—ì„œ ë©‹ì§„ íœ´ê°€ë¥¼ ë³´ëƒˆìŠµë‹ˆë‹¤. (-400ë§Œ)";
                break;
            case "VACATION_ASIA":
                this.state.cash -= 1500000;
                logMsg = "ë™ë‚¨ì•„ì—ì„œ í¸ì•ˆí•œ íœ´ê°€ë¥¼ ë³´ëƒˆìŠµë‹ˆë‹¤. (-150ë§Œ)";
                break;
            case "VACATION_STAY":
                logMsg = "ì§‘ì—ì„œ ì¡°ìš©íˆ íœ´ê°€ë¥¼ ë³´ëƒˆìŠµë‹ˆë‹¤.";
                break;

            // --- ëœë¤: íˆ¬ì ---
            case "STOCK_TECH":
                this.state.cash -= 10000000;
                this.state.stocks += 11000000;
                logMsg = "A ê¸°ìˆ ì£¼ì— 1000ë§Œì›ì„ íˆ¬ìí–ˆìŠµë‹ˆë‹¤.";
                break;
            case "STOCK_DIVIDEND":
                this.state.cash -= 10000000;
                this.state.stocks += 10000000;
                this.state.monthlyIncome += 50000;
                logMsg = "B ë°°ë‹¹ì£¼ì— 1000ë§Œì›ì„ íˆ¬ìí–ˆìŠµë‹ˆë‹¤. (ì›” 5ë§Œ ë°°ë‹¹)";
                break;
            case "STOCK_NO":
                logMsg = "ì£¼ì‹ íˆ¬ìë¥¼ í•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.";
                break;
            case "STOCK_MORE":
                let investAmount = Math.round(this.state.cash * 0.2);
                this.state.cash -= investAmount;
                this.state.stocks += investAmount;
                logMsg = `í˜„ê¸ˆì˜ 20% (${this.formatCurrency(investAmount)})ë¥¼ ì¶”ê°€ íˆ¬ìí–ˆìŠµë‹ˆë‹¤.`;
                break;
            case "STOCK_SELL":
                let sellAmount = Math.round(this.state.stocks * 0.5);
                this.state.stocks -= sellAmount;
                this.state.cash += sellAmount;
                logMsg = `íˆ¬ìê¸ˆì˜ 50% (${this.formatCurrency(sellAmount)})ë¥¼ í˜„ê¸ˆí™”í–ˆìŠµë‹ˆë‹¤.`;
                break;
            case "STOCK_HOLD":
                logMsg = "ì‹œì¥ì„ ê´€ë§í•˜ê¸°ë¡œ í–ˆìŠµë‹ˆë‹¤.";
                break;
            case "PROPERTY_BUY_OFFICE":
                this.state.cash -= 80000000;
                this.state.property += 100000000;
                this.state.monthlyIncome += 400000;
                logMsg = "ì˜¤í”¼ìŠ¤í…”ì„ ë§¤ìˆ˜í–ˆìŠµë‹ˆë‹¤. (-8000ë§Œ, ë¶€ë™ì‚° +1ì–µ, ì›” ìˆ˜ì… 40ë§Œ)";
                logType = "good";
                break;
            case "PROPERTY_NO":
                logMsg = "ì˜¤í”¼ìŠ¤í…”ì— íˆ¬ìí•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.";
                break;

            // --- ëœë¤: í–‰ìš´/ë¶ˆìš´ ---
            case "LOTTERY_WIN_SMALL":
                this.state.cash += 1000000;
                logMsg = "ë³µê¶Œ 3ë“± ë‹¹ì²¨! (100ë§Œ íšë“)";
                logType = "good";
                break;
            case "BONUS_GET":
                let bonus = this.state.monthlyIncome;
                this.state.cash += bonus;
                logMsg = `ê¹œì§ ë³´ë„ˆìŠ¤ ${this.formatCurrency(bonus)}ì„ ë°›ì•˜ìŠµë‹ˆë‹¤!`;
                logType = "good";
                break;
            case "HEALTH_PAY":
                this.state.cash -= 2000000;
                logMsg = "ë³‘ì›ë¹„ë¡œ 200ë§Œì›ì„ ì§€ì¶œí–ˆìŠµë‹ˆë‹¤.";
                logType = "bad";
                break;
            case "SCAM_YES":
                this.state.cash -= 10000000;
                logMsg = "ì‚¬ê¸°ì˜€ìŠµë‹ˆë‹¤! 1000ë§Œì›ì„ ìƒì—ˆìŠµë‹ˆë‹¤.";
                logType = "critical";
                break;
            case "SCAM_NO":
                logMsg = "ìˆ˜ìƒí•œ íˆ¬ìë¥¼ ë¬´ì‹œí•˜ê³  ìì‚°ì„ ì§€ì¼°ìŠµë‹ˆë‹¤.";
                break;

            // --- ëœë¤: 20ëŒ€ (ì—°ì• ) ---
            case "DATING_START":
                this.state.monthlyExpenses += 200000;
                this.state.flags.dating = true;
                logMsg = "ì—°ì• ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤. (ì›” 20ë§Œ ë°ì´íŠ¸ ë¹„ìš©)";
                break;
            case "DATING_NO":
                logMsg = "ì—°ì•  ëŒ€ì‹  ìê¸°ê³„ë°œì— ì§‘ì¤‘í•©ë‹ˆë‹¤.";
                break;

            default:
                console.warn(`Unhandled action: ${action} from event: ${eventId}`);
                logMsg = "ì•„ë¬´ ì¼ë„ ì¼ì–´ë‚˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.";
        }

        if (logMsg) {
            this.addLog(logMsg, logType);
        }
        
        // v2.27 ìˆ˜ì •:
        // ëª¨ë‹¬ ë‹«ê³  ê²Œì„ ì¬ê°œ (playGameì´ íë¥¼ í™•ì¸í•˜ê³  ë£¨í”„ë¥¼ ì¬ì‹œì‘í•¨)
        this.playGame(); 
    }


    // =========================================================================
    // UI ì—…ë°ì´íŠ¸ í—¬í¼
    // =========================================================================

    /**
     * ë§¤ì›” UIë¥¼ ìµœì‹  ìƒíƒœë¡œ ì—…ë°ì´íŠ¸
     */
    updateUI() {
        // ì‹œê³„ ë° ë‚˜ì´
        const ageYears = Math.floor(this.state.ageInMonths / 12);
        const ageMonths = this.state.ageInMonths % 12;
        this.dom.clock.innerText = `${ageYears}ì„¸ ${ageMonths}ê°œì›”`;

        // ì§„í–‰ ë°”
        const progressPercent = ((this.state.ageInMonths - 240) / (this.END_AGE_MONTHS - 240)) * 100;
        this.dom.progressBar.style.width = `${progressPercent}%`;
        this.dom.progressAge.innerText = `í˜„ì¬ ë‚˜ì´: ${ageYears}ì„¸`;

        // ì§ì—…
        this.dom.characterJob.innerText = this.state.job;

        // ì¬ì •
        const totalAssets = this.state.cash + this.state.stocks + this.state.property;
        const netIncome = this.state.monthlyIncome - this.state.monthlyExpenses;

        this.dom.totalAssets.innerText = this.formatCurrency(totalAssets);
        this.dom.cashAssets.innerText = this.formatCurrency(this.state.cash);
        this.dom.stockAssets.innerText = this.formatCurrency(this.state.stocks);
        this.dom.propertyAssets.innerText = this.formatCurrency(this.state.property);
        
        this.dom.monthlyIncome.innerText = `+ ${this.formatCurrency(this.state.monthlyIncome)}`;
        this.dom.monthlyExpenses.innerText = `- ${this.formatCurrency(this.state.monthlyExpenses)}`;
        
        this.dom.netIncome.innerText = this.formatCurrency(netIncome);
        this.dom.netIncome.className = netIncome >= 0 ? 'text-green-700 font-bold' : 'text-red-700 font-bold';
    }

    /**
     * ì´ë²¤íŠ¸ ë¡œê·¸ì— ë©”ì‹œì§€ ì¶”ê°€
     * @param {string} text - ë¡œê·¸ ë©”ì‹œì§€
     * @param {string} type - 'good', 'bad', 'critical', 'event', 'default'
     */
    addLog(text, type = "default") {
        const logItem = document.createElement('div');
        
        const typeClasses = {
            "good": "log-item-good",
            "bad": "log-item-bad",
            "critical": "log-item-critical",
            "event": "log-item-event",
            "default": "log-item-default"
        };
        logItem.className = `log-item ${typeClasses[type] || typeClasses['default']}`;

        const ageYears = Math.floor(this.state.ageInMonths / 12);
        const ageMonths = this.state.ageInMonths % 12;
        logItem.innerHTML = `<span class="font-semibold text-xs text-gray-500">[${ageYears}ì„¸ ${ageMonths}ê°œì›”]</span><p class="text-sm text-darkgray">${text}</p>`;
        
        this.dom.eventLog.prepend(logItem);
        
        if (this.dom.eventLog.children.length > 50) {
            this.dom.eventLog.lastChild.remove();
        }
    }

    /**
     * ìˆ«ì(ì›)ë¥¼ í†µí™” í˜•ì‹ (â‚© 1,000ë§Œ)ìœ¼ë¡œ ë³€í™˜
     * @param {number} amount - ê¸ˆì•¡
     * @returns {string} - í¬ë§·ëœ ë¬¸ìì—´
     */
    formatCurrency(amount) {
        if (amount >= 100000000) return `â‚© ${Math.floor(amount / 10000000) / 10}ì–µ`;
        if (amount >= 10000) return `â‚© ${Math.floor(amount / 1000) / 10}ë§Œ`;
        if (amount <= -100000000) return `- â‚© ${Math.floor(Math.abs(amount) / 10000000) / 10}ì–µ`;
        if (amount <= -10000) return `- â‚© ${Math.floor(Math.abs(amount) / 1000) / 10}ë§Œ`;
        return `â‚© ${amount.toLocaleString()}`;
    }

    // =========================================================================
    // AI ìºë¦­í„° ì´ë¯¸ì§€ ìƒì„± (ë‚˜ë…¸ë°”ë‚˜ë‚˜ API)
    // =========================================================================

    /**
     * í˜„ì¬ ìƒíƒœë¥¼ ê¸°ë°˜ìœ¼ë¡œ AI ìºë¦­í„° ì´ë¯¸ì§€ ìƒì„± (ë¹„ë™ê¸°)
     */
    async generateCharacterImage() {
        const age = Math.floor(this.state.ageInMonths / 12);
        const totalAssets = this.state.cash + this.state.stocks + this.state.property;

        // 1. ìƒíƒœì— ë”°ë¥¸ í”„ë¡¬í”„íŠ¸ ìƒì„±
        let ageDesc = `${age}ì„¸`;
        if (age < 30) ageDesc = `20ëŒ€ ì´ˆë°˜, ${age}ì„¸`;
        else if (age < 40) ageDesc = `30ëŒ€, ${age}ì„¸`;
        else if (age < 50) ageDesc = `40ëŒ€ ì¤‘ë…„, ${age}ì„¸`;
        else if (age < 60) ageDesc = `50ëŒ€ ì¤‘ë…„, ${age}ì„¸`;
        else ageDesc = `${age}ì„¸ ë…¸ë…„`;

        let emotion = "ë³´í†µ í‘œì •ì˜";
        let clothing = "í‰ë²”í•œ ì˜·ì„ ì…ì€";
        
        if (totalAssets > 500000000) {
            emotion = "í™œì§ ì›ƒëŠ” í‘œì •ì˜";
            clothing = this.state.gender === 'male' ? "ê³ ê¸‰ ì •ì¥ì„ ì…ì€" : "í™”ë ¤í•œ ë“œë ˆìŠ¤ë¥¼ ì…ì€";
        } else if (totalAssets < 0) {
            emotion = "ìŠ¬í”„ê³  ìš°ìš¸í•œ í‘œì •ì˜";
            clothing = "ë‚¡ê³  í—ˆë¦„í•œ ì˜·ì„ ì…ì€";
        }

        const prompt = `(í”½ì‚¬ ì• ë‹ˆë©”ì´ì…˜ ìŠ¤íƒ€ì¼), ${ageDesc} ${this.state.gender === 'male' ? 'ë‚¨ì' : 'ì—¬ì'} ìºë¦­í„°, ${emotion}, ${clothing}, (ìŠ¤íŠœë””ì˜¤ ì¡°ëª…), (ë‹¨ìƒ‰ ë°°ê²½), (ìƒë°˜ì‹  ìƒ·)`;
        
        // 2. UI ë¡œë”© ìƒíƒœë¡œ ë³€ê²½
        this.dom.characterLoading.innerText = "ìºë¦­í„° ìƒì„± ì¤‘...";
        this.dom.characterLoading.classList.remove('hidden');
        this.dom.characterImage.classList.add('hidden');
        
        try {
            // 3. API í˜¸ì¶œ
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-image-preview:generateContent?key=${this.NANO_BANANA_API_KEY}`;
            
            const payload = {
                contents: [{
                    parts: [{ text: prompt }]
                }],
                generationConfig: {
                    responseModalities: ['TEXT', 'IMAGE']
                },
            };

            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            if (!response.ok) {
                throw new Error(`API ìš”ì²­ ì‹¤íŒ¨: ${response.statusText}`);
            }

            const result = await response.json();
            const base64Data = result?.candidates?.[0]?.content?.parts?.find(p => p.inlineData)?.inlineData?.data;

            if (base64Data) {
                // 4. ì„±ê³µ ì‹œ ì´ë¯¸ì§€ í‘œì‹œ
                this.dom.characterImage.src = `data:image/png;base64,${base64Data}`;
                this.dom.characterImage.classList.remove('hidden');
                this.dom.characterLoading.classList.add('hidden');
            } else {
                throw new Error("API ì‘ë‹µì—ì„œ ì´ë¯¸ì§€ ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
            }

        } catch (error) {
            // 5. ì‹¤íŒ¨ ì‹œ ì˜¤ë¥˜ ë©”ì‹œì§€ í‘œì‹œ
            console.error("ìºë¦­í„° ì´ë¯¸ì§€ ìƒì„± ì‹¤íŒ¨:", error);
            this.dom.characterLoading.innerText = "(ìºë¦­í„° ìƒì„± ì‹¤íŒ¨)";
            this.dom.characterLoading.classList.remove('hidden');
            this.dom.characterLoading.style.color = '#9CA3AF'; // text-gray-400
            this.dom.characterImage.classList.add('hidden');
        }
    }
}
// js/main.js

// DOM(HTML) ì½˜í…ì¸ ê°€ ëª¨ë‘ ë¡œë“œë˜ë©´ ê²Œì„ì„ ì´ˆê¸°í™”í•˜ê³  ì‹¤í–‰í•©ë‹ˆë‹¤.
window.addEventListener('DOMContentLoaded', () => {
    // Game í´ë˜ìŠ¤ì˜ ì¸ìŠ¤í„´ìŠ¤(ì‹¤ì²´)ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
    const game = new Game();
    
    // ê²Œì„ì„ ì´ˆê¸°í™”í•©ë‹ˆë‹¤ (ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“± ì„¤ì •).
    game.init();
});










